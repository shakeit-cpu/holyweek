<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ê³ ë‚œì£¼ê°„ ì¶œì„ì²´í¬</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Noto Sans KR', sans-serif;
      background: #f9f6f2;
      margin: 0;
      padding: 1rem;
      text-align: center;
    }
    h1 {
      color: #5d3b09;
    }
    input, button {
      padding: 0.7rem;
      font-size: 1rem;
      border-radius: 8px;
      border: 1px solid #ccc;
      margin: 0.5rem;
    }
    #name {
      width: 60%;
      max-width: 300px;
    }
    #message {
      margin-top: 1rem;
      font-size: 1.2rem;
      font-weight: bold;
      color: #4caf50;
      animation: fadein 0.5s;
    }
    @keyframes fadein {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    #stats {
      margin-top: 2rem;
      display: none;
    }
    #attendanceChart {
      max-width: 100%;
    }
    #attendanceRecords {
      margin-top: 1rem;
      font-size: 1rem;
      text-align: left;
      max-height: 200px;
      overflow-y: scroll;
      border: 1px solid #ccc;
      padding: 1rem;
    }
  </style>
</head>
<body>
  <h1>ğŸ‘‹ ê³ ë‚œì£¼ê°„ ì¶œì„ ì²´í¬</h1>
  <input type="text" id="name" placeholder="ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”">
  <button onclick="checkIn()">âœ”ï¸ ì¶œì„</button>
  <div id="message"></div>
  <div style="margin-top: 1.5rem">
    <button id="adminBtn">ê´€ë¦¬ì ë©”ë‰´</button>
  </div>
  <div id="stats">
    <p>í˜„ì¬ ì¶œì„ì ìˆ˜: <strong id="count">0</strong> ëª…</p>
    <canvas id="attendanceChart" width="300" height="150"></canvas>
    <div id="attendanceRecords"></div>
    <button onclick="resetAttendance()">ì¶œì„ ê¸°ë¡ ì´ˆê¸°í™”</button>
  </div>

  <script>
    const storageKey = 'holy_week_attendance';
    const adminPassword = 'pass1234'; // ì›í•˜ëŠ” ë¹„ë°€ë²ˆí˜¸ë¡œ ë³€ê²½í•˜ì„¸ìš”

    function getToday() {
      const now = new Date();
      return now.toISOString().slice(0, 10);
    }

    function loadAttendance() {
      const data = localStorage.getItem(storageKey);
      return data ? JSON.parse(data) : {};
    }

    function saveAttendance(data) {
      localStorage.setItem(storageKey, JSON.stringify(data));
    }

    function checkIn() {
      const name = document.getElementById('name').value.trim();
      if (!name) return;

      const now = new Date();
      const today = getToday();
      const time = now.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
      const data = loadAttendance();
      if (!data[today]) data[today] = {};

      const alreadyChecked = data[today][name];

      if (alreadyChecked) {
        showMessage(`âŒ ${name} ë‹˜ì€ ì´ë¯¸ ${alreadyChecked} ì— ì¶œì„í•˜ì…¨ìŠµë‹ˆë‹¤.`);
        return;
      }

      data[today][name] = time;
      saveAttendance(data);
      showMessage(`âœ… ${name} ë‹˜, ì¶œì„ ì™„ë£Œ! (${time})`, true);
      updateCount();
      if (document.getElementById('stats').style.display !== 'none') {
        updateChart();
      }
    }

    function showMessage(msg, animate = false) {
      const msgBox = document.getElementById('message');
      msgBox.textContent = msg;
      msgBox.style.color = animate ? '#4caf50' : '#f44336';
      if (animate) {
        msgBox.style.animation = 'none';
        void msgBox.offsetWidth; // reflow trick
        msgBox.style.animation = 'fadein 0.5s';
      }
    }

    function updateCount() {
      const data = loadAttendance();
      const today = getToday();
      const count = data[today] ? Object.keys(data[today]).length : 0;
      document.getElementById('count').textContent = count;
    }

    function updateChart() {
      const data = loadAttendance();
      const labels = Object.keys(data).sort();
      const values = labels.map(date => Object.keys(data[date]).length);
      attendanceChart.data.labels = labels;
      attendanceChart.data.datasets[0].data = values;
      attendanceChart.update();
    }

    function showAttendanceRecords() {
      const data = loadAttendance();
      const recordsContainer = document.getElementById('attendanceRecords');
      recordsContainer.innerHTML = '<strong>ì¶œì„ ê¸°ë¡:</strong><br>';
      for (const date in data) {
        recordsContainer.innerHTML += `<strong>${date}</strong>:<br>`;
        for (const name in data[date]) {
          recordsContainer.innerHTML += `${name}: ${data[date][name]}<br>`;
        }
      }
    }

    function resetAttendance() {
      const confirmReset = confirm('ì •ë§ë¡œ ì¶œì„ ê¸°ë¡ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
      if (confirmReset) {
        localStorage.removeItem(storageKey);
        updateCount();
        document.getElementById('attendanceRecords').innerHTML = '';
        alert('ì¶œì„ ê¸°ë¡ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
      }
    }

    function promptAdmin() {
      const input = prompt('ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
      if (input === adminPassword) {
        document.getElementById('stats').style.display = 'block';
        showAttendanceRecords();
        updateChart();
      } else {
        alert('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.');
      }
    }

    // DOMContentLoaded ì´ë²¤íŠ¸ë¡œ ê´€ë¦¬ì ë²„íŠ¼ ì´ë²¤íŠ¸ ì—°ê²°
    document.addEventListener("DOMContentLoaded", function() {
      document.getElementById('adminBtn').addEventListener('click', promptAdmin);
    });

    const ctx = document.getElementById('attendanceChart').getContext('2d');
    const attendanceChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: [],
        datasets: [{
          label: 'ì¼ë³„ ì¶œì„ì ìˆ˜',
          backgroundColor: '#8e44ad',
          data: []
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: { beginAtZero: true }
        }
      }
    });

    updateCount();
  </script>
</body>
</html>
